<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ç–∞–ª–∞–Ω—Ç–æ–≤ –ê–ª–ª–æ–¥—ã 5.0.2</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: Arial, sans-serif; 
            background: #1a1a2e; 
            color: white; 
            padding: 20px;
        }
        
        /* –ö–ª–∞—Å—Å—ã */
        .class-selector { 
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .class-buttons { display: flex; flex-wrap: wrap; gap: 10px; }
        .class-btn { 
            padding: 12px 20px; 
            background: #4361ee; 
            border: none; 
            color: white; 
            border-radius: 8px; 
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        .class-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(67, 97, 238, 0.4); }
        .class-btn.active { background: #f72585; box-shadow: 0 0 20px rgba(247, 37, 133, 0.5); }
        
        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        .main-container {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
        }
        
        /* –í–µ—Ç–∫–∏ */
        .branches-container {
            display: grid;
            grid-template-columns: 400px 200px 200px 200px;
            gap: 20px;
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 10px;
        }
        
        /* –¢–∞–ª–∞–Ω—Ç—ã */
        .talent-branch { 
            background: rgba(255,255,255,0.1); 
            padding: 15px; 
            border-radius: 10px; 
        }
        .talent-branch h3 { 
            text-align: center; 
            margin-bottom: 15px; 
            color: #4cc9f0;
            border-bottom: 1px solid #4a5568;
            padding-bottom: 8px;
        }
        .talent-row { 
            display: flex; 
            justify-content: center; 
            gap: 10px; 
            margin-bottom: 15px; 
            min-height: 80px;
        }
        .talent { 
            width: 80px; 
            height: 80px; 
            background: linear-gradient(45deg, #2d3748, #4a5568);
            border: 2px solid #718096;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            text-align: center;
            transition: all 0.3s;
            position: relative;
            padding: 5px;
        }
        .talent:hover { border-color: #4cc9f0; transform: scale(1.05); }
        .talent.active { background: linear-gradient(45deg, #7209b7, #3a0ca3); border-color: #f72585; }
        .talent.locked { opacity: 0.4; cursor: not-allowed; }
        .talent-level {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
            min-width: 20px;
            text-align: center;
        }
        
        /* –í–µ—Ö–∏ */
        .milestone-branch { 
            background: rgba(255,255,255,0.1); 
            padding: 15px; 
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .milestone-grid {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            grid-template-rows: repeat(9, 1fr);
            gap: 4px;
            width: 200px;
            height: 200px;
        }
        .milestone {
            width: 20px;
            height: 20px;
            background: #4a5568;
            border: 2px solid #718096;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        .milestone:hover { border-color: #4cc9f0; transform: scale(1.2); }
        .milestone.active { background: #f72585; border-color: #f72585; }
        .milestone.locked { 
            opacity: 0.2; 
            cursor: not-allowed; 
            background: #2d3748;
            border: 2px dashed #718096;
        }
        .milestone.start { 
            background: #4cc9f0; 
            border-color: #4cc9f0; 
            box-shadow: 0 0 10px rgba(76, 201, 240, 0.5);
        }
        .milestone.disabled { 
            opacity: 0.1; 
            cursor: not-allowed; 
            background: transparent;
            border: 2px dotted #718096;
        }
        .milestone-level {
            position: absolute;
            bottom: -2px;
            right: -2px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 1px 3px;
            border-radius: 3px;
            font-size: 8px;
            font-weight: bold;
        }
        
        /* –ü—Ä–æ—Å—Ç—ã–µ CSS-—Ç—É–ª—Ç–∏–ø—ã */
        .talent:hover::before,
        .milestone:hover::before,
        .milestone-branch:hover::before {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            color: white;
            padding: 10px;
            border-radius: 6px;
            font-size: 12px;
            white-space: pre-line;
            z-index: 1000;
            min-width: 200px;
            max-width: 250px;
            border: 1px solid #4cc9f0;
            pointer-events: none;
        }
        
        .milestone-branch:hover::before {
            bottom: auto;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
        }
        
        /* –ü–∞–Ω–µ–ª—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ */
        .info-panel {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            height: fit-content;
        }
        .points-display {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        .points-box {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .points-box h4 {
            color: #4cc9f0;
            margin-bottom: 8px;
            font-size: 14px;
        }
        .points-value {
            font-size: 24px;
            font-weight: bold;
            color: #f72585;
        }
        .points-total {
            font-size: 14px;
            color: #a0aec0;
        }
        
        .controls { display: flex; flex-direction: column; gap: 10px; }
        button { 
            padding: 12px; 
            background: #4361ee; 
            color: white; 
            border: none; 
            border-radius: 6px; 
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        button:hover { background: #3a56d4; transform: translateY(-2px); }
        
        #buildCode {
            width: 100%;
            height: 80px;
            margin-top: 15px;
            background: #2d3748;
            color: white;
            border: 1px solid #4a5568;
            border-radius: 6px;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            resize: vertical;
        }
    </style>
</head>
<body>
    <h1>üéÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ç–∞–ª–∞–Ω—Ç–æ–≤ –ê–ª–ª–æ–¥—ã –û–Ω–ª–∞–π–Ω 5.0.2</h1>
    
    <div class="class-selector">
        <h3>–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞—Å—Å:</h3>
        <div class="class-buttons" id="classButtons"></div>
    </div>
    
    <div class="main-container">
        <div class="branches-container" id="branchesContainer"></div>
        
        <div class="info-panel">
            <div class="points-display">
                <div class="points-box">
                    <h4>–û—á–∫–∏ —Ç–∞–ª–∞–Ω—Ç–æ–≤</h4>
                    <div class="points-value" id="talentPoints">0</div>
                    <div class="points-total">–∏–∑ 30 –¥–æ—Å—Ç—É–ø–Ω–æ</div>
                </div>
                <div class="points-box">
                    <h4>–û—á–∫–∏ –≤–µ—Ö</h4>
                    <div class="points-value" id="milestonePoints">1</div>
                    <div class="points-total">–∏–∑ 41 –¥–æ—Å—Ç—É–ø–Ω–æ</div>
                </div>
            </div>
            
            <div class="controls">
                <button onclick="resetAll()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë</button>
                <button onclick="exportBuild()">üì§ –≠–∫—Å–ø–æ—Ä—Ç –±–∏–ª–¥–∞</button>
                <button onclick="importBuild()">üì• –ò–º–ø–æ—Ä—Ç –±–∏–ª–¥–∞</button>
            </div>
            
            <textarea id="buildCode" placeholder="–ö–æ–¥ –±–∏–ª–¥–∞ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å..." readonly></textarea>
        </div>
    </div>

    <script>
        // –î–ê–ù–ù–´–ï –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–†–ê
        const classes = {
            warrior: {
                name: "‚öîÔ∏è –í–æ–∏–Ω",
                talents: [
                    // –°—Ç—Ä–æ–∫–∞ 1
                    [
                        { 
                            id: "w1_1", 
                            name: "–°–∏–ª–∞ –æ—Ä—É–∂–∏—è", 
                            max: 3, 
                            req: [], 
                            desc: [
                                "–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å–∏–ª—É –∞—Ç–∞–∫–∏ –Ω–∞ 2%\n\n–†–∞–Ω–≥ 1/3",
                                "–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å–∏–ª—É –∞—Ç–∞–∫–∏ –Ω–∞ 4%\n\n–†–∞–Ω–≥ 2/3", 
                                "–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å–∏–ª—É –∞—Ç–∞–∫–∏ –Ω–∞ 6%\n\n–†–∞–Ω–≥ 3/3"
                            ]
                        },
                        { 
                            id: "w1_2", 
                            name: "–¢–≤–µ—Ä–¥–∞—è —Å—Ç–æ–π–∫–∞", 
                            max: 3, 
                            req: [], 
                            desc: [
                                "–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∑–∞—â–∏—Ç—É –Ω–∞ 3%\n\n–†–∞–Ω–≥ 1/3",
                                "–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∑–∞—â–∏—Ç—É –Ω–∞ 6%\n\n–†–∞–Ω–≥ 2/3",
                                "–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∑–∞—â–∏—Ç—É –Ω–∞ 9%\n\n–†–∞–Ω–≥ 3/3"
                            ]
                        },
                        { 
                            id: "w1_3", 
                            name: "–ë–æ–µ–≤–æ–π –¥—É—Ö", 
                            max: 3, 
                            req: [], 
                            desc: [
                                "–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∑–¥–æ—Ä–æ–≤—å–µ –Ω–∞ 2%\n\n–†–∞–Ω–≥ 1/3",
                                "–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∑–¥–æ—Ä–æ–≤—å–µ –Ω–∞ 4%\n\n–†–∞–Ω–≥ 2/3",
                                "–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∑–¥–æ—Ä–æ–≤—å–µ –Ω–∞ 6%\n\n–†–∞–Ω–≥ 3/3"
                            ]
                        }
                    ],
                    // –°—Ç—Ä–æ–∫–∞ 2
                    [
                        { 
                            id: "w2_1", 
                            name: "–ú–æ—â–Ω—ã–π —É–¥–∞—Ä", 
                            max: 3, 
                            req: ["w1_1"], 
                            desc: [
                                "–£—Ä–æ–Ω –∫—Ä–∏—Ç–∞ —É–≤–µ–ª–∏—á–µ–Ω –Ω–∞ 5%\n\n–†–∞–Ω–≥ 1/3",
                                "–£—Ä–æ–Ω –∫—Ä–∏—Ç–∞ —É–≤–µ–ª–∏—á–µ–Ω –Ω–∞ 10%\n\n–†–∞–Ω–≥ 2/3",
                                "–£—Ä–æ–Ω –∫—Ä–∏—Ç–∞ —É–≤–µ–ª–∏—á–µ–Ω –Ω–∞ 15%\n\n–†–∞–Ω–≥ 3/3"
                            ]
                        },
                        { 
                            id: "w2_2", 
                            name: "–ñ–µ–ª–µ–∑–Ω–∞—è –≤–æ–ª—è", 
                            max: 3, 
                            req: ["w1_2"], 
                            desc: [
                                "–°–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª—é +4%\n\n–†–∞–Ω–≥ 1/3",
                                "–°–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª—é +8%\n\n–†–∞–Ω–≥ 2/3",
                                "–°–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª—é +12%\n\n–†–∞–Ω–≥ 3/3"
                            ]
                        },
                        { 
                            id: "w2_3", 
                            name: "–í—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å", 
                            max: 3, 
                            req: ["w1_3"], 
                            desc: [
                                "–†–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–¥–æ—Ä–æ–≤—å—è +3%\n\n–†–∞–Ω–≥ 1/3",
                                "–†–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–¥–æ—Ä–æ–≤—å—è +6%\n\n–†–∞–Ω–≥ 2/3",
                                "–†–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–¥–æ—Ä–æ–≤—å—è +9%\n\n–†–∞–Ω–≥ 3/3"
                            ]
                        }
                    ]
                    // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏
                ],
                milestones: [
                    { 
                        name: "‚ö° –í–µ—Ö–∞ –°–∏–ª—ã", 
                        grid: createMilestoneGrid("strength"),
                        desc: "–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –±–æ–µ–≤—É—é —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ —É—Ä–æ–Ω\n\n–†–∞–∑–≤–∏–≤–∞–π—Ç–µ —ç—Ç—É –≤–µ—Ç–∫—É –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è —É—Ä–æ–Ω–∞"
                    },
                    { 
                        name: "üõ°Ô∏è –í–µ—Ö–∞ –ó–∞—â–∏—Ç—ã", 
                        grid: createMilestoneGrid("defense"),
                        desc: "–ü–æ–≤—ã—à–∞–µ—Ç –≤—ã–∂–∏–≤–∞–µ–º–æ—Å—Ç—å –∏ –∑–∞—â–∏—Ç–Ω—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏\n\n–£–ª—É—á—à–∞–µ—Ç –∑–∞—â–∏—Ç—É –∏ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ —É—Ä–æ–Ω—É"
                    },
                    { 
                        name: "üéØ –í–µ—Ö–∞ –¢–∞–∫—Ç–∏–∫–∏", 
                        grid: createMilestoneGrid("tactics"),
                        desc: "–£–ª—É—á—à–∞–µ—Ç —Ç–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å\n\n–î–∞–µ—Ç –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –±–æ–µ–º"
                    }
                ]
            }
            // ... –¥—Ä—É–≥–∏–µ –∫–ª–∞—Å—Å—ã
        };

        // –û–ü–ò–°–ê–ù–ò–Ø –í–ï–• –ü–û –£–†–û–í–ù–Ø–ú
        const milestoneDescriptions = {
            strength: [
                "–ë–∞–∑–æ–≤–∞—è —Å–∏–ª–∞\n+3% –∫ —Å–∏–ª–µ –∞—Ç–∞–∫–∏\n\n–£—Ä–æ–≤–µ–Ω—å 1",
                "–£—Å–∏–ª–µ–Ω–Ω–∞—è —Å–∏–ª–∞\n+6% –∫ —Å–∏–ª–µ –∞—Ç–∞–∫–∏\n\n–£—Ä–æ–≤–µ–Ω—å 2", 
                "–ü—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–∞—è —Å–∏–ª–∞\n+9% –∫ —Å–∏–ª–µ –∞—Ç–∞–∫–∏\n\n–£—Ä–æ–≤–µ–Ω—å 3"
            ],
            defense: [
                "–ë–∞–∑–æ–≤–∞—è –∑–∞—â–∏—Ç–∞\n+3% –∫ –∑–∞—â–∏—Ç–µ\n\n–£—Ä–æ–≤–µ–Ω—å 1",
                "–£—Å–∏–ª–µ–Ω–Ω–∞—è –∑–∞—â–∏—Ç–∞\n+6% –∫ –∑–∞—â–∏—Ç–µ\n\n–£—Ä–æ–≤–µ–Ω—å 2",
                "–ü—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–∞—è –∑–∞—â–∏—Ç–∞\n+9% –∫ –∑–∞—â–∏—Ç–µ\n\n–£—Ä–æ–≤–µ–Ω—å 3"
            ],
            tactics: [
                "–ë–∞–∑–æ–≤–∞—è —Ç–∞–∫—Ç–∏–∫–∞\n+3% –∫ —à–∞–Ω—Å—É –∫—Ä–∏—Ç–∞\n\n–£—Ä–æ–≤–µ–Ω—å 1",
                "–£—Å–∏–ª–µ–Ω–Ω–∞—è —Ç–∞–∫—Ç–∏–∫–∞\n+6% –∫ —à–∞–Ω—Å—É –∫—Ä–∏—Ç–∞\n\n–£—Ä–æ–≤–µ–Ω—å 2",
                "–ü—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–∞—è —Ç–∞–∫—Ç–∏–∫–∞\n+9% –∫ —à–∞–Ω—Å—É –∫—Ä–∏—Ç–∞\n\n–£—Ä–æ–≤–µ–Ω—å 3"
            ]
        };

        function createMilestoneGrid(type) {
            let grid = [];
            for (let i = 0; i < 9; i++) {
                let row = [];
                for (let j = 0; j < 9; j++) {
                    const isStart = (i === 4 && j === 4);
                    const isDisabled = isCellDisabled(i, j, type);
                    
                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —É—Ä–æ–≤–µ–Ω—å –≤–µ—Ö–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–∑–∏—Ü–∏–∏
                    const level = getMilestoneLevel(i, j, type);
                    
                    row.push({ 
                        id: `m_${type}_${i}_${j}`,
                        active: isStart, // –°—Ç–∞—Ä—Ç–æ–≤–∞—è –≤–µ—Ö–∞ –∞–∫—Ç–∏–≤–Ω–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                        start: isStart,
                        disabled: isDisabled,
                        level: level,
                        name: isDisabled ? "–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ö–∞" : `–í–µ—Ö–∞ ${getMilestoneTypeName(type)} –£—Ä.${level}`,
                        desc: isStart ? 
                            `–°—Ç–∞—Ä—Ç–æ–≤–∞—è —Ç–æ—á–∫–∞ ${getMilestoneTypeName(type)}\n–£–∂–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\n\n${milestoneDescriptions[type][0]}` : 
                            isDisabled ?
                            `–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ö–∞\n\n–≠—Ç–∞ —è—á–µ–π–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞\n–≤ –¥–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –∏–≥—Ä—ã` :
                            milestoneDescriptions[type][level - 1]
                    });
                }
                grid.push(row);
            }
            return grid;
        }

        function getMilestoneLevel(row, col, type) {
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —É—Ä–æ–≤–µ–Ω—å –≤–µ—Ö–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–∑–∏—Ü–∏–∏
            // –£—Ä–æ–≤–µ–Ω—å 1 - –±–ª–∏–∂–∞–π—à–∏–µ –∫ —Ü–µ–Ω—Ç—Ä—É
            // –£—Ä–æ–≤–µ–Ω—å 2 - —Å—Ä–µ–¥–Ω–µ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ  
            // –£—Ä–æ–≤–µ–Ω—å 3 - —Å–∞–º—ã–µ –¥–∞–ª—å–Ω–∏–µ –æ—Ç —Ü–µ–Ω—Ç—Ä–∞
            
            const distanceFromCenter = Math.max(Math.abs(row - 4), Math.abs(col - 4));
            
            if (distanceFromCenter <= 1) return 1;
            if (distanceFromCenter <= 3) return 2;
            return 3;
        }

        function isCellDisabled(row, col, type) {
            const disabledCells = {
                strength: [[0,0], [0,8], [8,0], [8,8], [2,2], [2,6], [6,2], [6,6]],
                defense: [[1,1], [1,7], [7,1], [7,7], [3,3], [3,5], [5,3], [5,5]],
                tactics: [[0,4], [4,0], [4,8], [8,4], [2,4], [4,2], [4,6], [6,4]]
            };
            
            return disabledCells[type]?.some(([r, c]) => r === row && c === col) || false;
        }

        function getMilestoneTypeName(type) {
            const names = {
                strength: "–°–∏–ª—ã",
                defense: "–ó–∞—â–∏—Ç—ã", 
                tactics: "–¢–∞–∫—Ç–∏–∫–∏"
            };
            return names[type] || "–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏";
        }

        // –ü–ï–†–ï–ú–ï–ù–ù–´–ï
        let currentClass = null;
        let talentPoints = 0;
        let milestonePoints = 1; // –°—Ç–∞—Ä—Ç–æ–≤–∞—è –≤–µ—Ö–∞ —É–∂–µ –∞–∫—Ç–∏–≤–Ω–∞
        const selectedTalents = {};
        const selectedMilestones = {
            "m_strength_4_4": true,
            "m_defense_4_4": true, 
            "m_tactics_4_4": true
        };

        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        function init() {
            createClassButtons();
        }

        function createClassButtons() {
            const container = document.getElementById('classButtons');
            for (const classId in classes) {
                const btn = document.createElement('button');
                btn.className = 'class-btn';
                btn.textContent = classes[classId].name;
                btn.onclick = () => selectClass(classId);
                container.appendChild(btn);
            }
        }

        function selectClass(classId) {
            currentClass = classId;
            talentPoints = 0;
            milestonePoints = 1;
            
            Object.keys(selectedTalents).forEach(key => delete selectedTalents[key]);
            Object.keys(selectedMilestones).forEach(key => {
                if (!key.includes('_4_4')) {
                    delete selectedMilestones[key];
                }
            });
            
            document.querySelectorAll('.class-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            renderBranches();
            updatePoints();
        }

        function renderBranches() {
            const container = document.getElementById('branchesContainer');
            container.innerHTML = '';
            
            const classData = classes[currentClass];
            
            // –í–µ—Ç–∫–∞ —Ç–∞–ª–∞–Ω—Ç–æ–≤
            const talentBranch = document.createElement('div');
            talentBranch.className = 'talent-branch';
            talentBranch.innerHTML = '<h3>üéØ –¢–∞–ª–∞–Ω—Ç—ã</h3>';
            
            classData.talents.forEach((row, rowIndex) => {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'talent-row';
                
                row.forEach(talent => {
                    const talentDiv = document.createElement('div');
                    talentDiv.className = 'talent';
                    const currentLevel = selectedTalents[talent.id] || 0;
                    const isLocked = talent.req.length > 0 && !talent.req.every(req => selectedTalents[req] > 0);
                    
                    if (currentLevel > 0) talentDiv.classList.add('active');
                    if (isLocked) talentDiv.classList.add('locked');
                    
                    talentDiv.innerHTML = `
                        <div style="font-size: 10px; line-height: 1.1;">${talent.name}</div>
                        <div class="talent-level">${currentLevel}/${talent.max}</div>
                    `;
                    
                    // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ —É—Ä–æ–≤–Ω—è
                    const desc = talent.desc[Math.min(currentLevel, talent.desc.length - 1)];
                    talentDiv.setAttribute('data-tooltip', `${talent.name}\n\n${desc}`);
                    
                    talentDiv.onclick = () => toggleTalent(talent.id, talent.max, talent.req);
                    rowDiv.appendChild(talentDiv);
                });
                
                talentBranch.appendChild(rowDiv);
            });
            
            container.appendChild(talentBranch);
            
            // –í–µ—Ç–∫–∏ –≤–µ—Ö
            classData.milestones.forEach((milestone, index) => {
                const milestoneBranch = document.createElement('div');
                milestoneBranch.className = 'milestone-branch';
                milestoneBranch.innerHTML = `<h3>${milestone.name}</h3>`;
                
                milestoneBranch.setAttribute('data-tooltip', `${milestone.name}\n\n${milestone.desc}`);
                
                const grid = document.createElement('div');
                grid.className = 'milestone-grid';
                
                milestone.grid.forEach((row, i) => {
                    row.forEach((cell, j) => {
                        const cellDiv = document.createElement('div');
                        cellDiv.className = 'milestone';
                        
                        if (cell.disabled) {
                            cellDiv.classList.add('disabled');
                        } else if (cell.start) {
                            cellDiv.classList.add('start');
                            cellDiv.classList.add('active');
                        } else if (selectedMilestones[cell.id]) {
                            cellDiv.classList.add('active');
                        }
                        
                        const isLocked = !cell.start && !cell.disabled && !isMilestoneAvailable(cell.id, i, j);
                        if (isLocked) cellDiv.classList.add('locked');
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º —É—Ä–æ–≤–µ–Ω—å –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤–µ—Ö
                        if (selectedMilestones[cell.id] && !cell.start) {
                            const levelSpan = document.createElement('span');
                            levelSpan.className = 'milestone-level';
                            levelSpan.textContent = cell.level;
                            cellDiv.appendChild(levelSpan);
                        }
                        
                        // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
                        cellDiv.setAttribute('data-tooltip', cell.desc);
                        
                        if (!cell.disabled && !isLocked) {
                            cellDiv.onclick = () => toggleMilestone(cell.id, i, j);
                        }
                        
                        grid.appendChild(cellDiv);
                    });
                });
                
                milestoneBranch.appendChild(grid);
                container.appendChild(milestoneBranch);
            });
        }

        function isMilestoneAvailable(milestoneId, row, col) {
            const type = getMilestoneTypeFromId(milestoneId);
            if (isCellDisabled(row, col, type)) {
                return false;
            }
            
            if (row === 4 && col === 4) return true;
            
            const neighbors = [
                [row-1, col], [row+1, col], [row, col-1], [row, col+1]
            ];
            
            return neighbors.some(([r, c]) => {
                return r >= 0 && r < 9 && c >= 0 && c < 9 && selectedMilestones[`m_${type}_${r}_${c}`];
            });
        }

        function getMilestoneTypeFromId(milestoneId) {
            return milestoneId.split('_')[1];
        }

        function toggleTalent(talentId, maxLevel, requirements) {
            if (talentPoints >= 30) return;
            
            const currentLevel = selectedTalents[talentId] || 0;
            const isLocked = requirements.length > 0 && !requirements.every(req => selectedTalents[req] > 0);
            
            if (isLocked) {
                alert('–ù–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è —ç—Ç–æ–≥–æ —Ç–∞–ª–∞–Ω—Ç–∞!');
                return;
            }
            
            if (currentLevel < maxLevel) {
                selectedTalents[talentId] = currentLevel + 1;
                talentPoints++;
            } else {
                delete selectedTalents[talentId];
                talentPoints--;
            }
            
            updatePoints();
            renderBranches();
        }

        function toggleMilestone(milestoneId, row, col) {
            if (milestonePoints >= 41 && !selectedMilestones[milestoneId]) return;
            
            if (!isMilestoneAvailable(milestoneId, row, col)) {
                alert('–ú–æ–∂–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ä—Ç–æ–≤—É—é –≤–µ—Ö—É –∏–ª–∏ —Å–æ—Å–µ–¥–Ω—é—é —Å –∞–∫—Ç–∏–≤–Ω–æ–π!');
                return;
            }
            
            if (selectedMilestones[milestoneId]) {
                delete selectedMilestones[milestoneId];
                milestonePoints--;
            } else {
                selectedMilestones[milestoneId] = true;
                milestonePoints++;
            }
            
            updatePoints();
            renderBranches();
        }

        function updatePoints() {
            document.getElementById('talentPoints').textContent = talentPoints;
            document.getElementById('milestonePoints').textContent = milestonePoints;
        }

        function resetAll() {
            talentPoints = 0;
            milestonePoints = 1;
            Object.keys(selectedTalents).forEach(key => delete selectedTalents[key]);
            Object.keys(selectedMilestones).forEach(key => {
                if (!key.includes('_4_4')) {
                    delete selectedMilestones[key];
                }
            });
            
            updatePoints();
            renderBranches();
        }

        function exportBuild() {
            const build = {
                class: currentClass,
                talents: selectedTalents,
                milestones: selectedMilestones,
                talentPoints: talentPoints,
                milestonePoints: milestonePoints
            };
            document.getElementById('buildCode').value = btoa(JSON.stringify(build));
        }

        function importBuild() {
            const code = prompt('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –±–∏–ª–¥–∞:');
            if (code) {
                try {
                    const build = JSON.parse(atob(code));
                    currentClass = build.class;
                    Object.assign(selectedTalents, build.talents);
                    Object.assign(selectedMilestones, build.milestones);
                    talentPoints = build.talentPoints || 0;
                    milestonePoints = build.milestonePoints || 1;
                    updatePoints();
                    renderBranches();
                    alert('–ë–∏–ª–¥ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω!');
                } catch (e) {
                    alert('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–¥ –±–∏–ª–¥–∞.');
                }
            }
        }

        // –ó–∞–ø—É—Å–∫
        init();
    </script>
</body>
</html>
