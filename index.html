<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Калькулятор талантов Аллоды 5.0.2</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: Arial, sans-serif; 
            background: #1a1a2e; 
            color: white; 
            padding: 20px;
        }
        
        /* Классы */
        .class-selector { margin-bottom: 20px; }
        .class-btn { 
            padding: 10px 15px; 
            margin: 5px; 
            background: #4361ee; 
            border: none; 
            color: white; 
            border-radius: 5px; 
            cursor: pointer;
        }
        .class-btn.active { background: #f72585; }
        
        /* Ветки */
        .branches-container {
            display: grid;
            grid-template-columns: 300px 100px 100px 100px;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        /* Таланты */
        .talent-branch { background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; }
        .talent-row { display: flex; gap: 10px; margin-bottom: 10px; }
        .talent { 
            width: 60px; height: 60px; 
            background: #4a5568; 
            border: 2px solid #718096;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            text-align: center;
        }
        .talent.active { background: #805ad5; border-color: #f72585; }
        .talent.locked { opacity: 0.3; cursor: not-allowed; }
        
        /* Вехи */
        .milestone-grid {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            grid-template-rows: repeat(9, 1fr);
            gap: 2px;
            width: 100px;
            height: 100px;
        }
        .milestone {
            width: 10px;
            height: 10px;
            background: #4a5568;
            border: 1px solid #718096;
            cursor: pointer;
        }
        .milestone.active { background: #f72585; }
        .milestone.locked { opacity: 0.3; cursor: not-allowed; }
        .milestone.start { background: #4cc9f0; }
        
        /* Инфо */
        .info-panel {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
        }
        .points { font-size: 18px; margin-bottom: 10px; }
        button { padding: 10px; margin: 5px; background: #4361ee; color: white; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Калькулятор талантов Аллоды 5.0.2</h1>
    
    <div class="class-selector">
        <h3>Выберите класс:</h3>
        <div id="classButtons"></div>
    </div>
    
    <div class="branches-container" id="branchesContainer"></div>
    
    <div class="info-panel">
        <div class="points">Очки: <span id="points">0</span>/71</div>
        <button onclick="resetAll()">Сбросить</button>
        <button onclick="exportBuild()">Экспорт</button>
        <button onclick="importBuild()">Импорт</button>
        <div>
            <textarea id="buildCode" style="width:100%; height:60px; margin-top:10px; background:#2d3748; color:white; border:none; padding:10px;"></textarea>
        </div>
    </div>

    <script>
        // ДАННЫЕ КАЛЬКУЛЯТОРА - ЗАПОЛНИ ЭТО!
        const classes = {
            warrior: {
                name: "Воин",
                talents: [
                    // 10 строк талантов
                    [
                        { id: "w1", name: "Сила", max: 5, req: [] },
                        { id: "w2", name: "Защита", max: 5, req: [] }
                    ],
                    [
                        { id: "w3", name: "Удар", max: 3, req: ["w1"] },
                        { id: "w4", name: "Блок", max: 3, req: ["w2"] }
                    ]
                    // ... добавь остальные 8 строк
                ],
                milestones: [
                    { name: "Веха Силы", grid: createGrid() },
                    { name: "Веха Защиты", grid: createGrid() },
                    { name: "Веха Тактики", grid: createGrid() }
                ]
            },
            paladin: {
                name: "Паладин",
                talents: [
                    // ... заполни таланты
                ],
                milestones: [
                    { name: "Веха Света", grid: createGrid() },
                    { name: "Веха Щита", grid: createGrid() },
                    { name: "Веха Веры", grid: createGrid() }
                ]
            }
            // ... добавь остальные классы
        };

        function createGrid() {
            let grid = [];
            for (let i = 0; i < 9; i++) {
                let row = [];
                for (let j = 0; j < 9; j++) {
                    row.push({ 
                        id: `m${i}${j}`, 
                        active: false,
                        start: (i === 4 && j === 4)
                    });
                }
                grid.push(row);
            }
            return grid;
        }

        // ПЕРЕМЕННЫЕ
        let currentClass = null;
        let points = 0;
        const selectedTalents = {};
        const selectedMilestones = {};

        // ИНИЦИАЛИЗАЦИЯ
        function init() {
            createClassButtons();
        }

        function createClassButtons() {
            const container = document.getElementById('classButtons');
            for (const classId in classes) {
                const btn = document.createElement('button');
                btn.className = 'class-btn';
                btn.textContent = classes[classId].name;
                btn.onclick = () => selectClass(classId);
                container.appendChild(btn);
            }
        }

        function selectClass(classId) {
            currentClass = classId;
            points = 0;
            Object.keys(selectedTalents).forEach(key => delete selectedTalents[key]);
            Object.keys(selectedMilestones).forEach(key => delete selectedMilestones[key]);
            
            // Убрать активность со всех кнопок
            document.querySelectorAll('.class-btn').forEach(btn => btn.classList.remove('active'));
            // Добавить активность текущей
            event.target.classList.add('active');
            
            renderBranches();
            updatePoints();
        }

        function renderBranches() {
            const container = document.getElementById('branchesContainer');
            container.innerHTML = '';
            
            const classData = classes[currentClass];
            
            // Ветка талантов
            const talentBranch = document.createElement('div');
            talentBranch.className = 'talent-branch';
            talentBranch.innerHTML = '<h3>Таланты</h3>';
            
            classData.talents.forEach((row, rowIndex) => {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'talent-row';
                
                row.forEach(talent => {
                    const talentDiv = document.createElement('div');
                    talentDiv.className = 'talent';
                    talentDiv.textContent = talent.name;
                    talentDiv.title = `${talent.name} (${selectedTalents[talent.id] || 0}/${talent.max})`;
                    
                    if (selectedTalents[talent.id]) {
                        talentDiv.classList.add('active');
                    }
                    
                    talentDiv.onclick = () => toggleTalent(talent.id, talent.max, talent.req);
                    rowDiv.appendChild(talentDiv);
                });
                
                talentBranch.appendChild(rowDiv);
            });
            
            container.appendChild(talentBranch);
            
            // Ветки вех
            classData.milestones.forEach((milestone, index) => {
                const milestoneBranch = document.createElement('div');
                milestoneBranch.className = 'talent-branch';
                milestoneBranch.innerHTML = `<h3>${milestone.name}</h3>`;
                
                const grid = document.createElement('div');
                grid.className = 'milestone-grid';
                
                milestone.grid.forEach((row, i) => {
                    row.forEach((cell, j) => {
                        const cellDiv = document.createElement('div');
                        cellDiv.className = 'milestone';
                        if (cell.start) cellDiv.classList.add('start');
                        if (selectedMilestones[cell.id]) cellDiv.classList.add('active');
                        
                        cellDiv.onclick = () => toggleMilestone(cell.id);
                        grid.appendChild(cellDiv);
                    });
                });
                
                milestoneBranch.appendChild(grid);
                container.appendChild(milestoneBranch);
            });
        }

        function toggleTalent(talentId, maxLevel, requirements) {
            if (points >= 71) return;
            
            const currentLevel = selectedTalents[talentId] || 0;
            
            if (currentLevel < maxLevel) {
                selectedTalents[talentId] = currentLevel + 1;
                points++;
            } else {
                delete selectedTalents[talentId];
                points--;
            }
            
            updatePoints();
            renderBranches();
        }

        function toggleMilestone(milestoneId) {
            if (points >= 71 && !selectedMilestones[milestoneId]) return;
            
            if (selectedMilestones[milestoneId]) {
                delete selectedMilestones[milestoneId];
                points--;
            } else {
                selectedMilestones[milestoneId] = true;
                points++;
            }
            
            updatePoints();
            renderBranches();
        }

        function updatePoints() {
            document.getElementById('points').textContent = points;
        }

        function resetAll() {
            points = 0;
            Object.keys(selectedTalents).forEach(key => delete selectedTalents[key]);
            Object.keys(selectedMilestones).forEach(key => delete selectedMilestones[key]);
            updatePoints();
            renderBranches();
        }

        function exportBuild() {
            const build = {
                class: currentClass,
                talents: selectedTalents,
                milestones: selectedMilestones,
                points: points
            };
            document.getElementById('buildCode').value = btoa(JSON.stringify(build));
        }

        function importBuild() {
            const code = prompt('Введите код билда:');
            if (code) {
                try {
                    const build = JSON.parse(atob(code));
                    currentClass = build.class;
                    Object.assign(selectedTalents, build.talents);
                    Object.assign(selectedMilestones, build.milestones);
                    points = build.points;
                    updatePoints();
                    renderBranches();
                } catch (e) {
                    alert('Ошибка импорта!');
                }
            }
        }

        // Запуск
        init();
    </script>
</body>
</html>
